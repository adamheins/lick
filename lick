#!/usr/bin/env python

from __future__ import print_function
__author__ = 'Adam Heins'

import argparse
import requests
from datetime import date

LICENSES = ['APACHE', 'MIT', 'BSD-2-CLAUSE', 'BSD-3-CLAUSE']
LICENSE_ROOT_URL = 'https://raw.githubusercontent.com/adamheins/lick/master/licenses'

def main():
    parser = argparse.ArgumentParser()
    parser.add_argument('type', nargs='?', help='Type of license to use.')
    parser.add_argument('-n', '--name', help='Specify the name in the license.')
    parser.add_argument('-l', '--list', help='List all available licenses.',
                        action='store_true')
    args = parser.parse_args()

    if args.list:
        for li in LICENSES:
            print(li)
        return

    if not args.type:
        return
    if not args.name:
        print('Error: --name flag is required.')
        return

    license = args.type.upper()
    if license not in LICENSES:
        print('Unsupported license: {}.'.format(args.type))
        return

    print('Licking {}...'.format(license))
    url = '/'.join([LICENSE_ROOT_URL, license])
    req = requests.get(url)
    if req.status_code != 200:
        print('Error: {} {}'.format(req.status_code, req.text))
        return

    text = req.text
    text = text.replace('<year>', str(date.today().year))
    text = text.replace('<name>', args.name)

    with open('LICENSE', 'w') as license:
        license.write(text)

if __name__ == '__main__':
    main()
